<!DOCTYPE html>
<html>
    <head>
        <title>LAZER TAG</title>
        <meta charset="utf-8" />
        <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
        <script https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
    </head>

    <body>
        <!-- our buttond to tell others -->
        <!-- <button id="red" style="background-color:rgb(255, 0, 0); color:rgb(255, 255, 255)">RED</button>
        <button id="blue" style="background-color:rgb(0, 0, 255); color:rgb(255, 255, 255)">BLUE</button> -->
        <a-scene player-pos background="color:rgb(0, 0, 0);">
            <a-entity id="player1" camera wasd-controls look-controls position="0 1.6 0">
                <a-entity   cursor raycaster="far:20; objects:.interactive" 
                            position="0 0 -0.1"
                            geometry="primitive: ring; radiusInner: 0.0004; radiusOuter: 0.001"
                            material="color: white; shader: flat"></a-entity>
            </a-entity>
            <a-entity id="HitBoxPlayer1" position="0 1.7 0">
                <a-entity geometry="primitive:box; width:0.5; depth:0.5; height:0.6;"></a-entity>
                <a-entity position="0 -0.8 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.8;"></a-entity>
            </a-entity>

            <a-entity id="player2" camera wasd-controls look-controls position="0 1.6 0">
                <a-entity   cursor raycaster="far:20; objects:.interactive" 
                            position="0 0 -0.1"
                            geometry="primitive: ring; radiusInner: 0.0004; radiusOuter: 0.001"
                            material="color: white; shader: flat"></a-entity>
            </a-entity>
            <a-entity id="HitBoxPlayer2" position="0 1.7 0">
                <a-entity geometry="primitive:box; width:0.5; depth:0.5; height:0.6;"></a-entity>
                <a-entity position="0 -0.8 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.8;"></a-entity>
            </a-entity>
                                             

            <a-entity class="ground"  geometry="primitive:plane; width:14; height:14;" material="color:white;" position="0 0.01 0" rotation="-90 0 0"></a-entity>

            <!-- red button -->
            <a-entity id="red_button" position="2 0.6 -1">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255, 100, 100)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <!-- blue button -->
            <a-entity id="blue_button" position="-2 0.6 -1">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(100, 100, 255)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(0, 0, 255); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(100, 100, 255); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>
        </a-scene>

        <!-- this is magic code created when the node server runs -->
        <!-- putting at the bottom of body to let body load first before we try to query for elements -->
        <!-- //VERY HANDY! https://socket.io/docs/v4/emit-cheatsheet/ -->
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            let playerNum = 0;

            socket.on('connect', (userData) => {
                console.log('I exist!');
                console.log(socket.id);
                playerNum++;
                console.log(playerNum);

                //put code here so that we know that socket.io has initailized ...
                document.querySelector('#red_button').querySelector('.button').addEventListener('click', function(){
                        socket.emit('red');
                });

                document.querySelector('#blue_button').querySelector('.button').addEventListener('click', function(){
                        socket.emit('blue');
                });

            });

            AFRAME.registerComponent('player-pos', {
                tick: function () {
                    let xPosPlayer1 = document.querySelector("#player1").getAttribute('position').x;
                    //console.log( "xPos: " + xPos);
                    let yPosPlayer1 = document.querySelector("#player1").getAttribute('position').y;
                    //console.log( "yPos: " + yPos);
                    let zPosPlayer1 = document.querySelector("#player1").getAttribute('position').z;
                    //console.log( "zPos: " + zPos);
                    let player1Position = xPosPlayer1 + ' ' + yPosPlayer1 + ' ' + zPosPlayer1;

                    let xRotPlayer1 = document.querySelector("#player1").getAttribute('rotation').x;
                    //console.log( "xRot: " + xPos);
                    let yRotPlayer1 = document.querySelector("#player1").getAttribute('rotation').y;
                    //console.log( "yRot: " + yPos);
                    let zRotPlayer1 = document.querySelector("#player1").getAttribute('rotation').z;
                    //console.log( "zRot: " + zPos);
                    let player1Rotation = xRotPlayer1 + ' ' + yRotPlayer1 + ' ' + zRotPlayer1;

                    //document.body.style.backgroundColor = colorStr;
                    document.querySelector('#HitBoxPlayer1').setAttribute('position', player1Position);
                    document.querySelector('#HitBoxPlayer1').setAttribute('rotation', player1Rotation);


                    let xPosPlayer2 = document.querySelector("#player2").getAttribute('position').x;
                    //console.log( "xPos: " + xPos);
                    let yPosPlayer2 = document.querySelector("#player2").getAttribute('position').y;
                    //console.log( "yPos: " + yPos);
                    let zPosPlayer2 = document.querySelector("#player2").getAttribute('position').z;
                    //console.log( "zPos: " + zPos);
                    let player2Position = xPosPlayer2 + ' ' + yPosPlayer2 + ' ' + zPosPlayer2;

                    let xRotPlayer2 = document.querySelector("#player2").getAttribute('rotation').x;
                    //console.log( "xRot: " + xPos);
                    let yRotPlayer2 = document.querySelector("#player2").getAttribute('rotation').y;
                    //console.log( "yRot: " + yPos);
                    let zRotPlayer2 = document.querySelector("#player2").getAttribute('rotation').z;
                    //console.log( "zRot: " + zPos);
                    let player2Rotation = xRotPlayer2 + ' ' + yRotPlayer2 + ' ' + zRotPlayer2;

                    //document.body.style.backgroundColor = colorStr;
                    document.querySelector('#HitBoxPlayer2').setAttribute('position', player2Position);
                    document.querySelector('#HitBoxPlayer2').setAttribute('rotation', player2Rotation);

                    
                }
            });

            //listen to event from server
            socket.on('color_change', (data) => {
                let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                console.log('color_change:' + colorStr);
                //document.body.style.backgroundColor = colorStr;
                document.querySelector('a-scene').setAttribute('background', {color:colorStr});
            });

        </script>
    </body>
</html>
