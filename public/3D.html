<!DOCTYPE html>
<html>
    <head>
        <title>LAZER TAG!</title>
        <meta charset="utf-8" />
        <!--Link needed assets-->
        <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
        <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
        <script src="javascript/variables.js"></script>
        <link rel="stylesheet" href="css/user-gesture.css">

        <script>
            //Start experience function
            AFRAME.registerComponent('start-experience',{
                init:function(){
                    console.log('scene loaded'); 
                    document.querySelector('#user-gesture-button').style.display='block';
                }
            });
            //will be called when "enter experience" is clicked
            const startExperience = function(){
                document.querySelector('#user-gesture-overlay').style.display='none';
                socket.emit('joinGame');
                //start background music
                let backgroundMusic = document.querySelector('#background-music');
                backgroundMusic.components.sound.playSound();
            };

        </script>

    </head>
    <body>
        <div id="user-gesture-overlay">
            <div class="center">
                <button id="user-gesture-button" onclick="startExperience()">Play LAZOR TAG!!!</button>
            </div>
        </div>
        <a-scene a-scene player-pos start-experience background="color:rgb(0, 0, 0);">
            <a-assets timeout="20000">
                <!--Loading all A-frame Assets-->
                
                <!--Audio assets-->
                <!--https://pixabay.com/sound-effects/80-synth-music-2-14672/-->
                <audio id="backgroundMusic" src="audio/backgroundMusic.mp3" preload="auto" crossorigin="anonymous" ></audio>

                <!--Environment assets (Made by me)-->
                <a-asset-item id="arenaModel" src="assets/LaserTagArena.glb" preload="auto" crossorigin="anonymous"></a-asset-item>
                <a-asset-item id="arenaModelNav" src="assets/LaserTagNav.glb" preload="auto" crossorigin="anonymous"></a-asset-item>



            </a-assets>
           <!--Background music-->
           <a-entity id="background-music" sound="src:#backgroundMusic; autoplay:false; loop:true; rolloffFactor:0; volume:0.1"></a-entity>

           <!--Player One camera and cursor--> 
           <a-entity id="player" 
                    movement-controls="speed: 0.4; constrainToNavMesh: true;" 
                    position="0 0 0">
                <!--Player one camera-->
                <a-entity   id="playercamera"
                            position="0 1.65 0" 
                            look-controls 
                            camera="active: true">
                    <!--Player one reticle-->
                    <a-entity   id="playercursor" 
                                cursor="rayOrigin:xrselect" 
                                raycaster="far:40; objects:.interactive" 
                                position="0 0 -0.1"
                                geometry="primitive: ring; radiusInner: 0.0004; radiusOuter: 0.001"
                                material="color: white; shader: standard; emissive: rgb(255, 255, 255);">
                    </a-entity>
                </a-entity> 
            </a-entity>
            <!--Player one body-->
            <a-entity   id="HitBoxPlayer1" 
                        position="0 2.5 0">
                <!--Head hit box-->
                <a-entity   id="headBox1"
                            position="0 -0.2 0"
                            class="button interactive"
                            geometry="primitive:box; width:0.5; depth:0.5; height:0.6;"
                            material="color: rgb(0, 187, 187); shader: standard; emissive: rgb(0, 187, 187);"
                            visible="true">
                </a-entity>
                <!--body hit box-->
                <a-entity   id="bodyBox1"
                            class="button interactive"
                            position="0 -1 0" 
                            geometry="primitive:box; width:0.5; depth:0.5; height:0.8;"
                            material="color: rgb(0, 187, 187);shader: standard; emissive: rgb(0, 187, 187);"
                            visible="true">
                </a-entity>
                <!--laser fire-->
                <a-entity   id="laserFireTeal"
                            position="0 -0.1 -20" 
                            rotation="90 0 0"
                            geometry="primitive: cylinder; height: 40; radius: 0.02;"
                            material="color: rgb(0, 187, 187);shader: standard; emissive: rgb(0, 187, 187);"
                            visible="false">
                </a-entity>
                <!--red screen to indicate being hit-->
                <a-entity   id="tealHitConfirm"
                            position="0 -0.3 0" 
                            geometry="primitive: cylinder; openEnded: false; height: 2.5;" 
                            material="color: red; side: double; emissive: rgb(255, 0, 0); opacity: 0.5;"
                            visible="false">
                </a-entity>
            </a-entity>

            
            <!--Player two body-->
            <a-entity   id="HitBoxPlayer2" 
                        position="0 2.5 0">
                <!--Head hit box-->
                <a-entity   id="headBox2"
                            class="button interactive"   
                            position="0 -0.2 0"          
                            geometry="primitive:box; width:0.5; depth:0.5; height:0.6;"
                            material="color: rgb(227, 11, 92); shader: standard; emissive: rgb(227, 11, 92);">
                </a-entity>
                <!--Body hit box-->
                <a-entity   id="bodyBox2"
                            class="button interactive"
                            position="0 -1 0" 
                            geometry="primitive:box; width:0.5; depth:0.5; height:0.8;"
                            material="color: rgb(255, 11, 92); shader: standard; emissive: rgb(227, 11, 92);">
                </a-entity>
                <!--laser fire-->
                <a-entity   id="laserFirePink"
                            position="0 -0.1 -20" 
                            rotation="90 0 0"
                            geometry="primitive: cylinder; height: 40; radius: 0.02;"
                            material="color: rgb(0, 187, 187);shader: standard; emissive: rgb(227, 11, 92);"
                            visible="false">
                </a-entity>
                <!--red screen to indicate being hit-->
                <a-entity   id="pinkHitConfirm"
                            position="0 -0.3 0" 
                            geometry="primitive: cylinder; openEnded: true; height: 2.5;" 
                            material="color: red; side: double; emissive: rgb(255, 0, 0); opacity: 0.5;"
                            visible="false">
                </a-entity>
            </a-entity>

            <!--A shield between the fighting area and friendly area so players can shoot each other when they aren't suppose to-->
            <a-entity   id="Shield" 
                        class="button interactive"
                        position="0 9 17" 
                        rotation="90 90 0"
                        geometry="primitive:box; width:2; depth:20; height:40;"
                        visible="false" >
            </a-entity>
            <!--Button for teleporting pink to their spot in the arena-->
            <a-entity   id="pinkButton" 
                        position="-4 0.6 4">
                <a-entity   class="button interactive" 
                            position="0 0.6 0" 
                            geometry="primitive:cylinder; radius:0.3; height:0.2;" 
                            material="color:rgb(255, 100, 100)"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300">
                </a-entity>
                <a-entity   position="0 -0.2 0" 
                            geometry="primitive:box; width:1; depth:1; height:1.5;" 
                            material="color:rgb(255, 255, 255)">
                </a-entity>
                <a-entity   position="0 1 0" 
                            rotation="0 180 0"
                            text="value: Player Two (Pink); width: 5; align: center;"> 
                </a-entity>
            </a-entity>

            <!--Button for teleporting teal to their spot in the arena-->
            <a-entity   id="tealButton" 
                        position="4 0.6 4">
                <a-entity   class="button interactive" 
                            position="0 0.6 0" 
                            geometry="primitive:cylinder; radius:0.3; height:0.2;" 
                            material="color:rgb(100, 155, 200)"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300">
                </a-entity>
                <a-entity   position="0 -0.2 0" 
                            geometry="primitive:box; width:1; depth:1; height:1.5;" 
                            material="color:rgb(255, 255, 255)">
                </a-entity>
                <a-entity   position="0 1 0" 
                            rotation="0 180 0"
                            text="value: Player One (Teal); width: 5; align: center;"> 
                </a-entity>
            </a-entity>

            <!--Button for teleporting both players to the coop area-->
            <a-entity   id="coopButton" 
            position="0 0.6 -4">
                <a-entity   class="button interactive" 
                            position="0 0.6 0" 
                            geometry="primitive:cylinder; radius:0.3; height:0.2;" 
                            material="color:rgb(255, 0, 255)"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300">
                </a-entity>
                <a-entity   position="0 -0.2 0" 
                            geometry="primitive:box; width:1; depth:1; height:1.5;" 
                            material="color:rgb(255, 255, 255)">
                </a-entity>
            </a-entity>
            <!--Button for starting the coop game-->
            <a-entity   id="startCoopGame" 
                        position="0 0.6 -40"
                        visible="true">
                <a-entity   class="button interactive" 
                            position="0 0.6 0" 
                            geometry="primitive:cylinder; radius:0.3; height:0.2;" 
                            material="color:rgb(255, 0, 255)"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300">
                </a-entity>
                <a-entity   position="0 -0.2 0" 
                            geometry="primitive:box; width:1; depth:1; height:1.5;" 
                            material="color:rgb(255, 255, 255)">
                </a-entity>
            </a-entity>
            <a-entity   position="0 2 -40" 
                        text="value: Start!; width: 10; align: center;"> 
            </a-entity>

            <!--Button for reloading players when teal wins-->
            <a-entity   id="tealWinsRestart" 
                        position="11.5 -25 0">
                    <a-entity   class="button interactive" 
                                position="0 0.6 0" 
                                geometry="primitive:cylinder; radius:0.3; height:0.2;" 
                                material="color:rgb(100, 155, 200)"
                                animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300">
                    </a-entity>
                    <a-entity   position="0 -0.2 0" 
                                geometry="primitive:box; width:1; depth:1; height:1.5;" 
                                material="color:rgb(255, 255, 255)">
                    </a-entity>
                    <a-entity   position="0 1 0" 
                                rotation="0 180 0"
                                text="value: Respawn; width: 5; align: center;"> 
                    </a-entity>
            </a-entity>
            <a-entity   position="11.5 -20 4.5" 
                        rotation="0 180 0"
                        text="value: Teal Wins; width: 50; align: center;">  >
            </a-entity>

            <!--Button for reloading players when pink wins-->
            <a-entity   id="pinkWinsRestart" 
                        position="35 -25 0">
                <a-entity   class="button interactive" 
                            position="0 0.6 0" 
                            geometry="primitive:cylinder; radius:0.3; height:0.2;" 
                            material="color:rgb(255, 100, 100)"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300">
                </a-entity>
                <a-entity   position="0 -0.2 0" 
                            geometry="primitive:box; width:1; depth:1; height:1.5;" 
                            material="color:rgb(255, 255, 255)">
                </a-entity>
                <a-entity   position="0 1 0" 
                            rotation="0 180 0"
                            text="value: Respawn; width: 5; align: center;"> 
                </a-entity>
            </a-entity>
            <a-entity   position="35 -20 4.5" 
                        rotation="0 180 0"
                        text="value: Pink Wins; width: 50; align: center;">  >
            </a-entity>

            <!--Button for reloading players when they win the co-op game-->
            <a-entity   id="coopWinRestart" 
                        position="-11.5 -25 0">
                <a-entity   class="button interactive" 
                            position="0 0.6 0" 
                            geometry="primitive:cylinder; radius:0.3; height:0.2;" 
                            material="color:rgb(100, 100, 100)"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300">
                </a-entity>
                <a-entity   position="0 -0.2 0" 
                            geometry="primitive:box; width:1; depth:1; height:1.5;" 
                            material="color:rgb(255, 255, 255)">
                </a-entity>
                <a-entity   position="0 1 0" 
                            rotation="0 180 0"
                            text="value: Respawn; width: 5; align: center;"> 
                </a-entity>
            </a-entity>
            <a-entity   position="-11.2 -20 4.5" 
                        rotation="0 180 0"
                        text="value: Hooray!; width: 50; align: center;">  >
            </a-entity>
           
            <!--Environment for the game world-->
            <a-entity   id="Environment;"
                        environment="preset:starry; ground:flat">

                <!--Arena-->
                <a-gltf-model   id="arena" 
                                gltf-model="#arenaModel" 
                                class="button interactive" 
                                position="0 0.1 0" 
                                rotation="0 90 0">
                </a-gltf-model>
                <!--Arena Nav Mesh (walkable areas_-->
                <a-gltf-model   id="arenaNavMesh" 
                                nav-mesh 
                                visible="false" 
                                gltf-model="#arenaModelNav" 
                                position="0 0.1 0" 
                                rotation="0 90 0">
                </a-gltf-model>
                <!--Comp Instructions-->
                <a-entity   id="compText"
                            position="0 3.5 10" 
                            rotation="0 180 0"
                            text="value: Competitive; width: 30; align: center;"> 
                    <a-entity   position="0 -1.5 0" 
                                text="value: Fight your friend in a 1V1 laser tag battle. Each player has three lives and the player who destroys all their opponents lives first wins. Good Luck!; width: 10; align: center;"> 
                    </a-entity>
                </a-entity>
                <!--Coop Instructions-->
                <a-entity   id="coopText"
                            position="0 3.5 -10" 
                            rotation="0 0 0"
                            text="value: Cooperative; width: 30; align: center;"> 
                    <a-entity   position="0 -1.7 0" 
                                text="value: Work with your friends to destroy 20 targets as fast as you can. Each player has their own set of targets they can shoot to contribute to the team's total. Good Luck!; width: 10; align: center;"> 
                    </a-entity>
                </a-entity>
            </a-entity>

            <!--Targets for the coop game-->
            <a-entity   id="targets"
                        position="0 10 -75"
                        rotation="90 0 0">
                <!--Teal target-->
                <a-entity   id="target1"
                            class="button interactive" 
                            onclick="tealTargetHit();"
                            position="2 1000 2" 
                            geometry="primitive:cylinder; radius:1; height:0.5;" 
                            material="color:rgb(150, 150, 255); emissive: rgb(0, 187, 187);"
                            visible="false">
                </a-entity>
                <!--Pink target-->
                <a-entity   id="target2"
                            class="button interactive" 
                            onclick="pinkTargetHit();"
                            position="-2 1000 -2" 
                            geometry="primitive:cylinder; radius:1; height:0.5;" 
                            material="color:rgb(255, 150, 150); emissive: rgb(227, 11, 92);"
                            visible="false">
                </a-entity>
            </a-entity>
        </a-scene>
        <!--Client Side Scripts-->
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            //When a player connects
            socket.on('connect', (userData) => {
                //Assign a local ID to their computer
                socket.on('assign_playernum', (data) => {
                    //set player number
                    playerNum = data.id;

                });
                //If player 1s head hit box is clicked
                document.querySelector('#headBox1').addEventListener('click', function(){
                    //if friendly is false
                    if(friendly === false && playerNum === 2){
                        //emit a hit to server
                        socket.emit('tealHit');
                    }
                });
                //If player 1s body hit box is clicked
                document.querySelector('#bodyBox1').addEventListener('click', function(){
                    //if friendly is false
                    if(friendly === false && playerNum === 2){
                        //emit a hit to server
                        socket.emit('tealHit');
                    }
                });
                //If player 2s head hit box is clicked
                document.querySelector('#headBox2').addEventListener('click', function(){
                    //if friendly is false
                    if(friendly === false && playerNum === 1){
                        //emit a hit to server   
                        socket.emit('pinkHit'); 
                    }
                });
                //If player 2s body hit box is clicked
                document.querySelector('#bodyBox2').addEventListener('click', function(){
                    //if friendly is false
                    if(friendly === false && playerNum === 1){
                        //emit a hit to server   
                        socket.emit('pinkHit');
                    }
                });
                
                //if the players are clicking anywhere
                document.addEventListener('click', function(){
                        //emit shooting to server
                        socket.emit('shooting');
                });
               
            //if the teal button is pressed
            document.querySelector('#tealButton').querySelector('.button').addEventListener('click', function(){
                //teleport teal to their side of the arena
                if (playerNum === 1)
                {
                document.querySelector('#player').setAttribute('position', '19 2.810 34');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                //make friendly false
                friendly = false;
                }
            });
            //if the pink button is pressed
            document.querySelector('#pinkButton').querySelector('.button').addEventListener('click', function(){
                //teleport pink to their side of the arena
                console.log(playerNum);
                if (playerNum === 2)
                {
                document.querySelector('#player').setAttribute('position', '-21.3 2.810 52');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                //make friendly false
                friendly = false;
                }
            });
            //if the coop button is pressed
            document.querySelector('#coopButton').querySelector('.button').addEventListener('click', function(){

                if (playerNum === 1)
                {
                //teleport player 1 to the coop arena
                document.querySelector('#player').setAttribute('position', '2 0 -32');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                }
                else if (playerNum === 2)
                {
                //teleport player 2 to the coop arena
                document.querySelector('#player').setAttribute('position', '-2 0 -32');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                }
            });
            //if the start coop button is pressed
            document.querySelector('#startCoopGame').querySelector('.button').addEventListener('click', function(){
                //if it is player one
                if(playerNum === 1){
                    //show player 1 targets
                    document.querySelector('#target1').setAttribute('position', '2 0 2');
                    document.querySelector('#target1').setAttribute('visible', 'true');

                }
                //if it is player two
                if(playerNum === 2){
                    //show player 2 targets
                    document.querySelector('#target2').setAttribute('position', '-2 0 -2');
                    document.querySelector('#target2').setAttribute('visible', 'true');
                }
            });
                //when recieve that player one is shooting
                socket.on('player1_shooting', (data) => {
                    if(data.id === "playerOne"){
                        //show laser for a moment
                        document.querySelector('#laserFireTeal').setAttribute('visible', 'true');
                        laser1Sound.play();
                        //hide laser again
                        setTimeout(() => document.querySelector('#laserFireTeal').setAttribute('visible', 'false'), 40);
                    };
                });
                //when recieve that player two is shooting
                socket.on('player2_shooting', (data) => {
                    if(data.id === "playerTwo"){
                        //show laser for a moment
                        document.querySelector('#laserFirePink').setAttribute('visible', 'true');
                        laser2Sound.play();
                        //hide laser again
                        setTimeout(() => document.querySelector('#laserFirePink').setAttribute('visible', 'false'), 40);
                    };
                });
            });
            //Function for constantly undating the players positions
            AFRAME.registerComponent('player-pos', {
                //Every rendered frame
                tick: function () {
                    //Get the position and rotation of player one
                    
                    let xPosPlayer1 = document.querySelector("#player").getAttribute('position').x ;
                    let yPosPlayer1 = document.querySelector("#player").getAttribute('position').y + 1.6;
                    let zPosPlayer1 = document.querySelector("#player").getAttribute('position').z;

                    let xRotPlayer1 = document.querySelector("#playercamera").getAttribute('rotation').x;
                    let yRotPlayer1 = document.querySelector("#playercamera").getAttribute('rotation').y;
                    let zRotPlayer1 = document.querySelector("#playercamera").getAttribute('rotation').z;
                    
                    //emit player two data to the server
                    socket.emit('player1Pos', {xPos:xPosPlayer1, yPos:yPosPlayer1, zPos:zPosPlayer1, xRot:xRotPlayer1, yRot:yRotPlayer1, zRot:zRotPlayer1});
                    
                    
                    //Get the position and rotation of player two
                    let xPosPlayer2 = document.querySelector("#player").getAttribute('position').x;
                    let yPosPlayer2 = document.querySelector("#player").getAttribute('position').y + 1.6;
                    let zPosPlayer2 = document.querySelector("#player").getAttribute('position').z;

                    let xRotPlayer2 = document.querySelector("#playercamera").getAttribute('rotation').x;
                    let yRotPlayer2 = document.querySelector("#playercamera").getAttribute('rotation').y;
                    let zRotPlayer2 = document.querySelector("#playercamera").getAttribute('rotation').z;
                    
                    //emit player two data to the server
                    socket.emit('player2Pos', {xPos:xPosPlayer2, yPos:yPosPlayer2, zPos:zPosPlayer2, xRot:xRotPlayer2, yRot:yRotPlayer2, zRot:zRotPlayer2});
                    
                }
            });

            //recieve the player one positions
            socket.on('player1_update', (data) => {
                
                //put position and rotation values together
                let player1Position = data.xPos + ' ' + data.yPos + ' ' + data.zPos;
                let player1Rotation = data.xRot + ' ' + data.yRot + ' ' + data.zRot;
                //Change the position and rotation
                document.querySelector('#HitBoxPlayer1').setAttribute('position', player1Position);
                document.querySelector('#HitBoxPlayer1').setAttribute('rotation', player1Rotation);
            });

            //recieve the player one positions from the server
            socket.on('player2_update', (data) => {

                //put position and rotation values together
                let player2Position = data.xPos + ' ' + data.yPos + ' ' + data.zPos;
                let player2Rotation = data.xRot + ' ' + data.yRot + ' ' + data.zRot;
                //Change the position and rotation from the server
                document.querySelector('#HitBoxPlayer2').setAttribute('position', player2Position);
                document.querySelector('#HitBoxPlayer2').setAttribute('rotation', player2Rotation);
            });

            //recieve the teal wins data from the server
            socket.on('teal_wins', (data) => {
                //if teal gets two hits on pink
                if(tealHits === 2){
                    //Show that pink had been hit
                    document.querySelector('#pinkHitConfirm').setAttribute('visible', 'true');
                    victorySound.play();
                    setTimeout(() => document.querySelector('#pinkHitConfirm').setAttribute('visible', 'false'), 1000);
                    //move the player positions to the "teal wins room"
                    if(playerNum === 1)
                    {
                        document.querySelector('#player').setAttribute('position', '14 -25 0');
                        document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                        document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                        document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    else if (playerNum === 2)
                    {
                        document.querySelector('#player').setAttribute('position', '10 -25 0');
                        document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                        document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                        document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    

                    
                    //set friendly back to true
                    friendly = true;
                    //makes teals hits 0
                    tealHits = 0;

                    //if the respawn button in the middle of the room is pressed 
                    document.querySelector('#tealWinsRestart').querySelector('.button').addEventListener('click', function(){
                        //reload the page
                        window.location.reload()
                    });
                }
                else{
                    //show that pink had been hit
                    document.querySelector('#pinkHitConfirm').setAttribute('visible', 'true');
                    victorySound.play();
                    setTimeout(() => document.querySelector('#pinkHitConfirm').setAttribute('visible', 'false'), 1000);

                    if (playerNum === 1)
                    {
                     //move the player back to starting positions"
                    document.querySelector('#player').setAttribute('position', '19 2.810 34');
                    document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                    document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                    document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    else if (playerNum === 2)
                    {
                    document.querySelector('#player').setAttribute('position', '-21.3 2.810 52');
                    document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                    document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                    document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    //increase teals total hits
                    tealHits++;
                }
            });
            //recieve the pink wins data from the server
            socket.on('pink_wins', (data) => {
                if(pinkHits === 2){
                    //Show that teal had been hit
                    document.querySelector('#tealHitConfirm').setAttribute('visible', 'true');
                    victorySound.play();
                    setTimeout(() => document.querySelector('#tealHitConfirm').setAttribute('visible', 'false'), 1000);
                    //move the player positions to the "pink wins room"
                    if (playerNum === 1)
                    {
                    document.querySelector('#player').setAttribute('position', '37 -25 0');
                    document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                    document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                    document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    else if(playerNum === 2)
                    {
                    document.querySelector('#player').setAttribute('position', '33 -25 0');
                    document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                    document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                    document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    //set friendly back to true
                    friendly = true;
                    //reset pinks hits
                    pinkHits = 0;

                    //if the respawn button in the middle of the room is pressed 
                    document.querySelector('#pinkWinsRestart').querySelector('.button').addEventListener('click', function(){
                        //reload the page
                        window.location.reload()
                    });
                }
                else{
                    //show that teal had been hit
                    document.querySelector('#tealHitConfirm').setAttribute('visible', 'true');
                    victorySound.play();
                    setTimeout(() => document.querySelector('#tealHitConfirm').setAttribute('visible', 'false'), 1000);
                    //move the players back to their starting positions
                    if (playerNum === 1)
                    {
                    document.querySelector('#player').setAttribute('position', '19 2.810 34');
                    document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                    document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                    document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    else if (playerNum === 2)
                    {
                    document.querySelector('#player').setAttribute('position', '-21.3 2.810 52');
                    document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                    document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                    document.querySelector('#player').components['movement-controls'].updateNavLocation();
                    }
                    //increase pinks total hits
                    pinkHits++;
                }
            });

            //Function for when teal targets are hit in coop mode
            function tealTargetHit(){
                //if the function is called increase teal score
                score++;
                //if the target is hit
                if(score === 1 || score === 11){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '-3 -2 -4');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 2 || score === 12){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '3 2 4');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 3 || score === 13){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '-15 2 -2');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 4 || score === 14){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '-5 6 1');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 5 || score === 15){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '10 0 -2');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 6 || score === 16){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '10 5 -3');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 7 || score === 17){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '6 5 7');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 8 || score === 18){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '12 5 2');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 9 || score === 19){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '20 5 0');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the target is hit
                if(score === 10 || score === 20){
                    //changes it's position
                    document.querySelector('#target1').setAttribute('position', '2 0 2');
                    //emit the hit to the server
                    socket.emit('tealTallyScore', {tealScore: score});
                }
                //if the score equals 21
                if(score === 21){
                    //reset it
                    score = 0;
                }
            }
            //Function for when pink targets are hit in coop mode
            function pinkTargetHit(){
                //if the function is called increase pinks score
                score++;
                //if the target is hit
                if(score === 1 || score === 11){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', ' 3  2  4');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 2 || score === 12){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '-3 -2 -4');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 3 || score === 13){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '15 -2 2');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 4 || score === 14){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '5 -6 -1');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 5 || score === 15){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '-10 -0 2');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 6 || score === 16){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '-10 -5 3');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 7 || score === 17){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '-6 -5 -7');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 8 || score === 18){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '-12 -5 -2');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 9 || score === 19){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '-20 -5 -0');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the target is hit
                if(score === 10 || score === 20){
                    //changes it's position
                    document.querySelector('#target2').setAttribute('position', '-2 0 -2');
                    //emit the hit to the server
                    socket.emit('pinkTallyScore', {pinkScore: score});
                }
                //if the score equals 21
                if(score === 21){
                    //reset it
                    score = 0;
                }
            }
            //recieve that the player won in the coop game
            socket.on('coopWin', (data) => {
                //move the players to the coop mode victory room
                if (playerNum === 1)
                {
                document.querySelector('#player').setAttribute('position', '-14 -25 0');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                }
                else if (playerNum === 2)
                {
                document.querySelector('#player').setAttribute('position', '-10 -25 0');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                }
                //if the button in the middle of the room is pressed
                document.querySelector('#coopWinRestart').querySelector('.button').addEventListener('click', function(){
                    //reload the page
                    window.location.reload();
                });
            });
            socket.on('resetScores', (data) => {
                tealHits = 0;
                pinkHits = 0;
                console.log(playerNum);
                if (playerNum === 1)
                {
                document.querySelector('#player').setAttribute('position', '0 0 0');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer1').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                }
                if (playerNum === 2)
                {
                document.querySelector('#player').setAttribute('position', '0 0 0');
                document.querySelector('#playercamera').setAttribute('position', '0 1.65 0');
                document.querySelector('#HitBoxPlayer2').setAttribute('position', '0 2.5 0');
                document.querySelector('#player').components['movement-controls'].updateNavLocation();
                }
            });
        </script>
    </body>
</html>
